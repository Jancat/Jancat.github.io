<!DOCTYPE html>
<html lang="zh" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Vue MVVM (defineProperty) 实现 - 键落云起</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="君临" />
  <meta name="description" content="" />

  <meta name="keywords" content="Hugo, theme, jane, 博客" />






<meta name="generator" content="Hugo 0.55.2" />


<link rel="canonical" href="https://jancat.github.io/post/2019/vue-mvvm/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.ec807d8b802a40889537c26e014f733206312ea440d42e1f0dabed80918de1ac.css" integrity="sha256-7IB9i4AqQIiVN8JuAU9zMgYxLqRA1C4fDavtgJGN4aw=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Vue MVVM (defineProperty) 实现" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jancat.github.io/post/2019/vue-mvvm/" />
<meta property="article:published_time" content="2019-04-19T23:33:14&#43;08:00"/>
<meta property="article:modified_time" content="2019-04-20T12:18:00&#43;08:00"/>

<meta itemprop="name" content="Vue MVVM (defineProperty) 实现">
<meta itemprop="description" content="">


<meta itemprop="datePublished" content="2019-04-19T23:33:14&#43;08:00" />
<meta itemprop="dateModified" content="2019-04-20T12:18:00&#43;08:00" />
<meta itemprop="wordCount" content="0">



<meta itemprop="keywords" content="vue,mvvm," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Vue MVVM (defineProperty) 实现"/>
<meta name="twitter:description" content=""/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">键落云起</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://jancat.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://jancat.github.io/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://jancat.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://jancat.github.io/about/">关于</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css" integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css" integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin="anonymous">




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      键落云起
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://jancat.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://jancat.github.io/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://jancat.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://jancat.github.io/about/">关于</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Vue MVVM (defineProperty) 实现</h1>
      
      <div class="post-meta">
        <time datetime="2019-04-19" class="post-time">
          2019-04-19
        </time>
        <div class="post-category">
            <a href="https://jancat.github.io/categories/vue/"> Vue </a>
            
          </div>
        <span class="more-meta"> 约 0 字 </span>
          <span class="more-meta"> 预计阅读 0 分钟 </span>

        
        
          <span id="busuanzi_container_page_pv">
            | 阅读 <span id="busuanzi_value_page_pv"></span>
          </span>
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#vue-响应式原理">Vue 响应式原理</a>
<ul>
<li><a href="#数据劫持">数据劫持</a></li>
<li><a href="#发布-订阅">发布-订阅</a></li>
<li><a href="#mvvm-各模块职责">MVVM 各模块职责</a></li>
</ul></li>
<li><a href="#mvvm-原理实现">MVVM 原理实现</a>
<ul>
<li><a href="#index-html">index.html</a></li>
<li><a href="#mvvm-模块">MVVM 模块</a></li>
<li><a href="#dep-模块">Dep 模块</a></li>
<li><a href="#observer-模块">Observer 模块</a>
<ul>
<li><a href="#observer-named-export">Observer named export</a></li>
</ul></li>
<li><a href="#watcher-模块">Watcher 模块</a>
<ul>
<li><a href="#监听嵌套属性">监听嵌套属性</a></li>
<li><a href="#重复的-dep">重复的 Dep</a></li>
</ul></li>
<li><a href="#compiler-模块">Compiler 模块</a>
<ul>
<li><a href="#documentfragment">DocumentFragment</a></li>
<li><a href="#指令解析">指令解析</a></li>
<li><a href="#v-model-双向绑定">v-model 双向绑定</a></li>
<li><a href="#监听属性变化">监听属性变化</a></li>
<li><a href="#属性值更新">属性值更新</a></li>
</ul></li>
<li><a href="#回顾">回顾</a></li>
</ul></li>
<li><a href="#安利">安利</a></li>
<li><a href="#参考">参考</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p><img src="https://cn.vuejs.org/images/data.png" alt="Vue MVVM Poster" /></p>

<h2 id="vue-响应式原理">Vue 响应式原理</h2>

<p>Vue 2.x 的响应式原理是通过 <strong>数据劫持</strong> 和 <strong>发布-订阅</strong>模式实现的。</p>

<p>初始化 Vue 实例时内部就会定义数据劫持和创建发布-订阅模式。</p>

<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g1pnu3komuj31z40m0wn6.jpg" alt="Vue MVVM" /></p>

<h3 id="数据劫持">数据劫持</h3>

<p><strong>数据劫持</strong> 通过 <code>Object.defineProperty()</code> 劫持传入的 <code>data</code>，对 <code>data</code> 属性(包括嵌套对象) 的操作进行监听（通过 getter/setter），从而触发一系列响应。</p>

<p>在 <a href="https://cn.vuejs.org/v2/guide/reactivity.html">官方文档-深入响应式原理</a> 中也说明了 Vue 在初始化实例后 <strong>无法检测到对象属性的添加或删除</strong>，需要通过 <code>Vue.set(vm.someObject, 'b', 2)</code> 或者 <code>this.$set(this.someObject,'b',2)</code> 的方式动态添加新的响应式属性，即给新的属性添加 getter/setter。</p>

<h3 id="发布-订阅">发布-订阅</h3>

<p><strong>发布-订阅</strong>模式是数据劫持之后的响应，订阅中心 <strong>Dep</strong> 收集对 <strong>Data</strong> 各个属性的依赖，<strong>Watcher</strong> 作为订阅者订阅这些依赖；依赖项的 setter 触发时，会通知对应的 <strong>Watcher</strong>，从而触发更新。</p>

<h3 id="mvvm-各模块职责">MVVM 各模块职责</h3>

<ul>
<li><strong>MVVM</strong>: Vue 实例初始化，调用 <strong>Observer</strong> 数据劫持，调用 <strong>Compiler</strong> 解析模板；</li>
<li><strong>Observer</strong>: 劫持 data 全部属性，定义 setter 、getter，添加和通知订阅者；</li>
<li><strong>Compiler</strong>: 解析模板初始化视图，收集模板中的数据依赖，创建订阅者订阅变化，绑定更新函数；</li>
<li><strong>Dep</strong>：订阅中心，提供添加、移除、通知订阅的接口；</li>
<li><strong>Watcher</strong>: data 属性的订阅者，收到变化通知后调用更新函数更新视图。</li>
</ul>

<h2 id="mvvm-原理实现">MVVM 原理实现</h2>

<p>为了理解 Vue MVVM 内部原理，这里造一个简单的 MVVM 伪轮子，能够实现模板解析、数据响应式等基本功能，忽略细节和明显的 bug。同时，为了更容易理解和更好的 coding 体验，使用现代浏览器支持的 ES6+ 语法实现，划分各个模块。</p>

<p>这个轮子中借助 ES5 的 <code>Object.defineProperty()</code> 实现数据劫持；在<a href="https://jancat.github.io/post/2019/vue-mvvm-proxy/">下一篇</a>中，将会使用 ES6 的 <code>Proxy</code> 实现，这也是 Vue 3 的计划之一。</p>

<p>效果：</p>

<iframe src="https://codesandbox.io/embed/q7j083qmyq?autoresize=1&fontsize=14&hidenavigation=1&view=preview" title="vue-mvvm" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

<h3 id="index-html">index.html</h3>

<iframe src="https://codesandbox.io/embed/q7j083qmyq?autoresize=1&fontsize=16&hidenavigation=1&view=editor" title="vue-mvvm" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

<p>入口文件，创建渲染模板，通过 <code>v-model</code> 指令双向绑定 <code>data</code>，同理 <code>v-class</code>、<code>v-text</code>、<code>v-html</code> 指令插入 <code>data</code> 值，<code>v-on:click</code> 绑定点击事件监听器 <code>method</code>。</p>

<p>在 <code>module script</code> 中导入并实例化 MVVM，定义 <code>el</code>、<code>data</code>、<code>computed</code>、<code>methods</code>、<code>$watch</code> options。</p>

<h3 id="mvvm-模块">MVVM 模块</h3>

<iframe src="https://codesandbox.io/embed/q7j083qmyq?autoresize=1&fontsize=16&hidenavigation=1&module=%2FMVVM.js&view=editor" title="vue-mvvm" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

<p>MVVM 构造函数中把 <code>options.data</code>、<code>options.computed</code>、<code>options.methods</code> 中的属性全部绑定到 MVVM <code>this</code> 上，这样就能在 <code>methods</code> 中通过 <code>this.xxx</code> 代理到各自的 key 中，暂时不考虑重复的 key。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// data 代理，实现 vm.xxx, this.xxx -&gt; vm.$data.xxx
</span><span class="c1"></span><span class="nx">_proxyData</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">const</span> <span class="p">{</span> <span class="nx">$data</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">$data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">get</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$data</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
      <span class="p">},</span>
      <span class="nx">set</span><span class="p">(</span><span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$data</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newVal</span>
      <span class="p">},</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// computed 属性代理，实现 vm.xxx, this.xxx -&gt; this.$options.computed.xxx
</span><span class="c1"></span><span class="nx">_proxyComputed</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">const</span> <span class="nx">computed</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$options</span><span class="p">.</span><span class="nx">computed</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">computed</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">computed</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">get</span><span class="o">:</span>
        <span class="k">typeof</span> <span class="nx">computed</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span>
        <span class="o">?</span> <span class="nx">computed</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
        <span class="o">:</span> <span class="nx">computed</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">get</span><span class="p">,</span>
        <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{},</span>
      <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 绑定 options.methods 的方法到 this 上
</span><span class="c1"></span><span class="nx">_bindMethods</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">const</span> <span class="nx">methods</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$options</span><span class="p">.</span><span class="nx">methods</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">methods</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">methods</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span>
        <span class="k">this</span><span class="p">,</span>
        <span class="nx">key</span><span class="p">,</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyDescriptor</span><span class="p">(</span><span class="nx">methods</span><span class="p">,</span> <span class="nx">key</span><span class="p">),</span>
      <span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p>初始化 <code>this</code> 代理后，调用 <code>Observer</code> 劫持 <code>data</code> 中的全部属性：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">observe</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$data</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
<p>最后，调用 <code>Compiler</code> 解析模板：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">$compile</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Compiler</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">el</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
<p>MVVM 实例也提供了 <code>$watch</code> 方法，调用 <code>Watcher</code> 监听指定属性的变化：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">$watch</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">new</span> <span class="nx">Watcher</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h3 id="dep-模块">Dep 模块</h3>

<iframe src="https://codesandbox.io/embed/q7j083qmyq?autoresize=1&fontsize=16&hidenavigation=1&module=%2FDep.js&view=editor" title="vue-mvvm" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

<p><strong>Dep</strong> 模块作为<strong>发布-订阅</strong>模式的订阅中心，每个 <code>data</code> 中的属性(包括嵌套) 都绑定了一个 <code>Dep</code> 实例(通过闭包引用)，提供添加、通知、移除订阅者的接口。</p>

<p>一个属性绑定的 <code>Dep</code> 实例可以包含多个订阅该属性的 <code>Watcher</code> 实例，属性变化后，将通知这些 <code>Watcher</code> 实例。</p>

<h3 id="observer-模块">Observer 模块</h3>

<iframe src="https://codesandbox.io/embed/q7j083qmyq?autoresize=1&fontsize=16&hidenavigation=1&module=%2FObserver.js&view=editor" title="vue-mvvm" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

<p><strong>Observer</strong> 模块依赖 <strong>Dep</strong> 模块。</p>

<p>Observer 构造函数递归劫持 <code>data</code> 中的全部属性，定义 getter 和 setter，同时为每个属性绑定一个 Dep 实例。</p>

<p>在属性的 getter 中判断当前 <code>Dep.target</code> 是否指向一个 <code>Watcher</code> 实例，如果是，则把该 <code>Watcher</code> 实例作为属性订阅者添加到 <code>Dep</code> 中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">get</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 访问该 key 时如果 Dep.target 指向 Watcher 实例，把该 key 对应的 Dep 实例传递给 Watcher 实例
</span><span class="c1"></span>  <span class="c1">// 也可以直接 dep.addSub(Dep.target)
</span><span class="c1"></span>  <span class="nx">Dep</span><span class="p">.</span><span class="nx">target</span> <span class="o">&amp;&amp;</span> <span class="nx">dep</span><span class="p">.</span><span class="nx">depend</span><span class="p">()</span>
  <span class="k">return</span> <span class="nx">val</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p>在属性的 setter 中当值变化后通过闭包引用的 <code>Dep</code> 实例通知订阅者：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">set</span><span class="p">(</span><span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">newVal</span> <span class="o">===</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="nx">val</span> <span class="o">=</span> <span class="nx">newVal</span>
  <span class="c1">// 新的值是object的话，进行监听
</span><span class="c1"></span>  <span class="nx">observe</span><span class="p">(</span><span class="nx">newVal</span><span class="p">)</span>
  <span class="c1">// 通知订阅该 key 的 Watcher 实例
</span><span class="c1"></span>  <span class="nx">dep</span><span class="p">.</span><span class="nx">notify</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h4 id="observer-named-export">Observer named export</h4>

<p><code>Observer</code> 模块导出的不是 <code>Observer class</code>，而是 <code>observe</code> 函数，用于递归实例化 <code>Observer</code> 劫持嵌套的 <code>data key</code> 对象。相当于 <code>data</code> 中的每个嵌套对象都对应一个 <code>Observer</code> 实例，包括 <code>data</code> 本身。不过在这个轮子中没有用到 <code>Observer</code> 实例的引用。</p>

<h3 id="watcher-模块">Watcher 模块</h3>

<iframe src="https://codesandbox.io/embed/q7j083qmyq?autoresize=1&fontsize=16&hidenavigation=1&module=%2FWatcher.js&view=editor" title="vue-mvvm" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

<p><strong>Watcher</strong> 模块依赖 <strong>Dep</strong> 模块。</p>

<p><code>Watcher</code> 在初始化时将会把 <code>Dep.target</code> 指向自身的 <code>this</code>，然后访问监听的属性，触发 <code>Observer</code> 中定义的属性 getter，从而把当前 <code>Watcher</code> 实例添加到属性订阅者中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 获取 Wacher 实例监视的值
</span><span class="c1"></span><span class="nx">_getValue</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 访问监听的属性时把 Dep.target 指向自身，从而在 Observer 中把当前实例添加到属性订阅者中
</span><span class="c1"></span>  <span class="nx">Dep</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="k">this</span>
  <span class="k">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vm</span><span class="p">)</span>
  <span class="c1">// 获取属性值后置空 Dep.target
</span><span class="c1"></span>  <span class="nx">Dep</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="kc">null</span>
  <span class="k">return</span> <span class="nx">value</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h4 id="监听嵌套属性">监听嵌套属性</h4>

<p>如果 <code>Watcher</code> 实例监听的是嵌套属性，比如 <code>a.b.c</code>，关注的是 <code>c</code> 值的变化。则在访问 <code>a</code> 时，<code>a</code> 绑定的 <code>Dep</code> 实例会把当前 <code>Watcher</code> 实例添加到订阅者中，同理 <code>b</code>、<code>c</code>，即一个 <code>Watcher</code> 实例的引用同时存在于嵌套属性的父属性 <code>Dep</code> 订阅者中；当父属性值变化时，也会通知到子属性的订阅者。</p>

<h4 id="重复的-dep">重复的 Dep</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">applyDep</span><span class="p">(</span><span class="nx">dep</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">depIds</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">dep</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">dep</span><span class="p">.</span><span class="nx">addSub</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">depIds</span><span class="p">[</span><span class="nx">dep</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">dep</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p>假如相应属性的 <code>dep.id</code> 已经在当前 <code>watcher</code> 的 <code>depIds</code> 里，说明不是一个新的属性，仅仅是改变了其值而已，则不需要将当前 <code>watcher</code> 添加到该属性的 <code>dep</code> 里。</p>

<p>假如相应属性是新的属性，则将当前 <code>watcher</code> 添加到新属性的<code>dep</code>里，如通过 <code>vm.child = {name: 'a'}</code> 改变了 <code>child.name</code> 的值，<code>child.name</code> 就是个新属性，则需要将当前<code>watcher(child.name)</code>加入到新的 <code>child.name</code> 的<code>dep</code>里。因为此时 <code>child.name</code> 是个新值，之前的 <code>setter</code>、<code>dep</code> 都已经失效，如果不把 <code>watcher</code> 加入到新的 <code>child.name</code> 的<code>dep</code>中，通过 <code>child.name = xxx</code> 赋值的时候，对应的 <code>watcher</code> 就收不到通知，等于失效了。</p>

<h3 id="compiler-模块">Compiler 模块</h3>

<iframe src="https://codesandbox.io/embed/q7j083qmyq?autoresize=1&fontsize=16&hidenavigation=1&module=%2FCompiler.js&view=editor" title="vue-mvvm" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

<p><strong>Compiler</strong> 模块依赖 <strong>Watcher</strong> 模块。</p>

<h4 id="documentfragment">DocumentFragment</h4>

<p><code>Compiler</code> 实例化时先把模板节点的子节点全部转移到 <code>DocumentFragment</code> 中进行节点操作，避免频繁 reflow，影响性能；在模板解析完后再把 <code>DocumentFragment</code> 转移到根节点下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">nodeToFragment</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="nx">fragment</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">()</span>

  <span class="c1">// 将原生节点移动到fragment
</span><span class="c1"></span>  <span class="kd">let</span> <span class="nx">child</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">firstChild</span>
  <span class="k">while</span> <span class="p">(</span><span class="nx">child</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fragment</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">child</span><span class="p">)</span>
    <span class="nx">child</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">firstChild</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">fragment</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h4 id="指令解析">指令解析</h4>

<p><code>Compiler</code> 解析模板中的 <code>v-</code> 前缀的指令和 <code>{{ exp }}</code> 文本插值表达式，该轮子忽略 <code>JavaScript</code> 插值表达式。能够解析的指令有 <code>v-model</code>、 <code>v-class</code>、<code>v-text</code>、<code>v-html</code>、<code>v-on</code>，这些指令都是引用 <code>data</code> 中的属性，触发 <code>Observer</code> 定义的 getter 和 setter。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 指令处理集合
</span><span class="c1"></span><span class="k">const</span> <span class="nx">compilerUtils</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">text</span><span class="p">()</span> <span class="p">{},</span>
  <span class="nx">html</span><span class="p">()</span> <span class="p">{},</span>
  <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h4 id="v-model-双向绑定">v-model 双向绑定</h4>

<p><code>v-model</code> 指令绑定的属性，<code>View</code> 和 <code>Model</code> 中的值变化互相影响，即双向绑定。</p>

<p>监听 <code>v-model</code> 指令所在的 <code>node input</code> 事件，<code>input</code> 变化后通过 <code>vm.xxx</code> 改变对应的 <code>model</code> 属性值，触发该属性定义的 setter，即实现了 <code>View</code> 影响 <code>Model</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">model</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">vm</span><span class="p">,</span> <span class="nx">exp</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">vm</span><span class="p">,</span> <span class="nx">exp</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">)</span>

  <span class="kd">let</span> <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getVMVal</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nx">exp</span><span class="p">)</span>
  <span class="nx">node</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">const</span> <span class="nx">newValue</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setVMVal</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nx">exp</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">)</span>
    <span class="nx">val</span> <span class="o">=</span> <span class="nx">newValue</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h4 id="监听属性变化">监听属性变化</h4>

<p>每个指令引用的 <code>data</code> 属性都需要实例化 <code>Watcher</code> 进行监听，并同时绑定更新函数给 <code>Watcher</code> 收到变化通知后调用，更新视图：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">bind</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">vm</span><span class="p">,</span> <span class="nx">exp</span><span class="p">,</span> <span class="nx">dir</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="nx">updaterFn</span> <span class="o">=</span> <span class="nx">updater</span><span class="p">[</span><span class="nx">dir</span> <span class="o">+</span> <span class="s1">&#39;Updater&#39;</span><span class="p">]</span>

  <span class="nx">updaterFn</span> <span class="o">&amp;&amp;</span> <span class="nx">updaterFn</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getVMVal</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nx">exp</span><span class="p">))</span>

  <span class="k">new</span> <span class="nx">Watcher</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nx">exp</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">oldValue</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">updaterFn</span> <span class="o">&amp;&amp;</span> <span class="nx">updaterFn</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">oldValue</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h4 id="属性值更新">属性值更新</h4>

<p>监听的属性值变化后，每个指令都对应不同的更新操作，比如替换 <code>textContent</code>、<code>innerHTML</code>、<code>value</code> 等：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">updater</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">textUpdater</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">value</span>
  <span class="p">},</span>
  <span class="nx">htmlUpdater</span><span class="p">()</span> <span class="p">{}</span>
  <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p>在这个轮子中，更新 DOM 是同步执行的，而且不涉及 Virtual DOM。在 Vue 中会对 Virtual DOM 更新然后缓存在异步更新队列，在下一个事件循环 <strong>tick</strong> 中 flush 到 DOM。</p>

<h3 id="回顾">回顾</h3>

<p><strong>MVVM</strong> 模式降低了 <strong>View</strong> 与 <strong>Model</strong> 的耦合，由 <strong>ViewModel</strong> 自动处理 View 与 Model 的数据同步，解决了数据频繁更新（操作 DOM）的问题。View 通过使用<strong>模板语法</strong>来<strong>声明式</strong>的将数据渲染进 DOM，当 ViewModel 对 Model 进行更新的时候，会通过数据绑定更新到 View。Model (在本文中就是 <code>data</code>) 仅仅关注数据层本身，不关心任何行为；Model 的数据模型结合视图和业务实体。</p>

<p><del>宠着</del>，画了个各模块的关系图帮助理解：</p>

<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1g27t19vigyj30tq0wd42d.jpg" alt="image-20190419115645881" /></p>

<p>最后，本轮子 GitHub 地址：<a href="https://github.com/Jancat/vue-mvvm">https://github.com/Jancat/vue-mvvm</a></p>

<p><strong>Follow</strong> or <strong>Star</strong>，你选哪个？</p>

<p>（<del>不，小孩子才做选择，大人全都要</del>）</p>

<h2 id="安利">安利</h2>

<p>安利一波本文中使用到的工具：</p>

<ul>
<li><a href="https://codesandbox.io">CodeSandbox</a> : 基于 VSCode 编辑器的 <strong>Cloud IDE</strong>，内置各种流行框架模板。通过 <code>&lt;iframe&gt;</code> 提供 <strong>embed</strong> 的项目、代码预览，方便的嵌入文章中，乃展示效果、项目代码的行文利器。</li>
<li><a href="https://www.processon.com">ProcessOn</a>：在线绘制思维导图、流程图等，UI 美观，效果拔群。不过免费版有文件数量限制。</li>
</ul>

<h2 id="参考">参考</h2>

<p>本轮子基于下面的仓库代码改造，感谢！</p>

<p><a href="https://github.com/DMQ/mvvm">https://github.com/DMQ/mvvm</a></p>

<hr />

<p><strong>兄弟篇</strong>：<a href="https://jancat.github.io/post/2019/vue-mvvm-proxy/">Vue MVVM 实现（Proxy 篇）</a></p>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">君临</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2019-04-20 12:44</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a target="_blank" rel="license noopener external nofollow" href="https://creativecommons.org/licenses/by/4.0/deed.zh" >署名 4.0 国际</a></span>
  </p>
</div>

    
    
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/images/wechat-reward-code.jpg">
        <span>微信打赏</span>
      </label>
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/images/alipay-qr-code.jpg">
        <span>支付宝打赏</span>
      </label>
  </div>
</div>

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://jancat.github.io/tags/vue/">vue</a>
          <a href="https://jancat.github.io/tags/mvvm/">mvvm</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/2019/vue-mvvm-proxy/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Vue MVVM 实现 （Proxy 篇）</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/2018/use-elementary-os/">
            <span class="next-text nav-default">使用 Elementary OS</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "Jancat/Jancat.github.io"
            issue-term="pathname"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  
  
    



        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:szujunlinpan@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://stackoverflow.com/users/4281309/junlin" rel="me noopener" class="iconfont"
      title="stack-overflow"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M809.714286 932.571429l-638.857143 0 0-274.285714-91.428571 0 0 365.714286 821.714286 0 0-365.714286-91.428571 0 0 274.285714zm-538.285714-299.428571l18.857143-89.714286 447.428571 94.285714-18.857143 89.142857zm58.857143-213.714286l38.285714-83.428571 414.285714 193.714286-38.285714 82.857143zm114.857143-203.428571l58.285714-70.285714 350.857143 293.142857-58.285714 70.285714zm226.857143-216l272.571429 366.285714-73.142857 54.857143-272.571429-366.285714zm-410.285714 840.571429l0-90.857143 457.142857 0 0 90.857143-457.142857 0z"></path>
</svg>

    </a>
  
    <a href="https://github.com/Jancat" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/Jancat/" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="https://jancat.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2018 -
    2019
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        君临
        
      </span></span>

  
  
    <span id="busuanzi_container">
      访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>






  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.js" integrity="sha256-AC9ChpELidrhGHX23ZU53vmRdz3FhKaN9E28+BbcWBw=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js" integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin="anonymous"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>










</body>
</html>
